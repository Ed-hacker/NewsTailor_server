================================================================================
                    Project-TNP 뉴스 추천 알고리즘 정리
================================================================================

작성일: 2025-11-11
프로젝트: Project-TNP (Today's News Personalized)


================================================================================
1. 랭킹 뉴스 알고리즘 (모든 사용자에게 동일)
================================================================================

📌 목적:
   전체 사용자에게 동일하게 보이는 "오늘의 TOP 20 뉴스" 선정
   사회적 영향력이 큰 이슈를 중심으로 다양한 주제를 커버

📌 입력:
   - 네이버 랭킹 뉴스 페이지 크롤링 (약 400개 뉴스)
   - 각 언론사별 1~5위 랭킹 뉴스

📌 알고리즘 구조: 하이브리드 방식 (Phase 1 + Phase 2)

--------------------------------------------------------------------------------
Phase 1: Java 기반 키워드 클러스터링
--------------------------------------------------------------------------------

1.1. 키워드 추출 및 빈도 계산
   - 각 뉴스 제목에서 키워드 추출
   - 방법:
     * 공백, 특수문자 기준으로 토큰 분리
     * 2글자 이상 단어만 추출
     * 불용어 제거 (조사, 접속사 등)

   예시:
   제목: "대통령실 폭발물 설치 협박글 작성자 추적"
   키워드: [대통령실, 폭발물, 설치, 협박글, 작성자, 추적]

1.2. 클러스터링
   - 같은 키워드를 포함한 뉴스들을 그룹화
   - 2회 이상 등장한 키워드만 유의미한 클러스터로 간주

   예시:
   클러스터 "대장동":
   - "대장동 수익금 몰수? 민사 가능"
   - "대장동 항소 포기한 날 치맥 파티"
   - "대장동 428억원 뇌물 무죄"

1.3. 클러스터 점수 계산
   공식:
   클러스터 점수 = (클러스터 크기 × 3) + (언론사 다양성 × 2) + (평균 순위 점수)

   - 클러스터 크기: 해당 키워드를 포함한 뉴스 개수
   - 언론사 다양성: 서로 다른 언론사 개수
   - 평균 순위 점수: (6 - 평균 순위)

   예시:
   클러스터 "대장동": 크기 15개, 언론사 8개, 평균순위 2.5
   점수 = (15 × 3) + (8 × 2) + (6 - 2.5) = 45 + 16 + 3.5 = 64.5

1.4. 후보 선정 (100개)
   - 점수 높은 클러스터부터 순회
   - 각 클러스터에서 대표 뉴스 선택
     * 큰 클러스터(5개 이상): 최대 3개
     * 작은 클러스터(3-4개): 최대 2개
   - 상위 100개 후보 선정

--------------------------------------------------------------------------------
Phase 2: Gemini AI 기반 최종 선정
--------------------------------------------------------------------------------

2.1. Gemini에게 전달되는 정보
   - 100개 후보 뉴스 목록
   - 각 뉴스의 클러스터 정보 (키워드, 크기, 언론사 다양성)

   예시:
   1. [클러스터: 대장동, 크기: 15개, 언론사: 8개] [조선일보 1위] 제목...
   2. [클러스터: 내란, 크기: 23개, 언론사: 12개] [한겨레 1위] 제목...

2.2. Gemini 선정 규칙
   절대 규칙:
   - 각 클러스터에서 무조건 1개만 선택
   - 정확히 20개를 선택

   선택 방법:
   1. 클러스터를 크기 순으로 정렬
   2. 큰 클러스터부터 순서대로 1개씩 선택
   3. 20개가 될 때까지 계속 선택

2.3. 중복 제거 (Java 코드)
   - Gemini가 선택한 뉴스를 파싱
   - 제목 유사도 체크 (Jaccard Similarity, 2-gram 기반)
   - 70% 이상 유사하면 중복으로 판단하여 제거
   ->
  1. 여러 클러스터에 동시 포함된
  뉴스:
    - 예: "대통령 내란 탄핵"
  뉴스가 "대통령" 클러스터와
  "내란" 클러스터 양쪽에 포함
    - 이 경우 Gemini가 실수로
  같은 뉴스를 두 번 선택할 가능성
  2. Gemini가 규칙을 완벽히
  따르지 않는 경우:
    - AI 모델이 가끔 지시를 놓칠
  수 있음
의 문제들을 해결할 수 있다.

   예시:
   "李대통령 '내란 문제, 특검에만 의존 말고...'"
   "이 대통령 '내란 문제, 특검에만 의존 말고...'"
   → 유사도 95% → 중복 제거

📌 최종 출력:
   - 중복 없는 20개 랭킹 뉴스
   - DB에 저장 (title, url, summary, rank)
   - 모든 사용자에게 동일하게 제공


================================================================================
2. 개인화 요약 뉴스 알고리즘 (사용자별 맞춤)
================================================================================

📌 목적:
   사용자가 선택한 관심 카테고리(정치, 경제, 사회 등)별로
   가장 중요한 뉴스 4개를 선별하고 요약하여 제공

📌 입력:
   - 사용자의 관심 카테고리 (예: [정치, IT/과학])
   - 각 카테고리별 네이버 뉴스 40개 크롤링

📌 알고리즘 구조: Gemini AI 기반 키워드 빈도 분석

--------------------------------------------------------------------------------
Step 1: 카테고리별 뉴스 크롤링
--------------------------------------------------------------------------------

1.1. 섹션별 크롤링
   - 네이버 뉴스 각 섹션에서 최신 40개 수집
   - 섹션:
     * 정치 (100)
     * 경제 (101)
     * 사회 (102)
     * IT/과학 (105)
     * 세계 (104)
     * 생활/문화 (103)

1.2. 뉴스 데이터
   - 제목, URL, 언론사명 수집
   - 본문은 크롤링하지 않음 (Gemini 요약 시 불필요)

--------------------------------------------------------------------------------
Step 2: Gemini AI 기반 선정 및 요약
--------------------------------------------------------------------------------

2.1. Gemini에게 전달되는 프롬프트

   입력:
   [섹션명] 카테고리의 뉴스 목록:
   1. [조선일보] 대통령실 폭발물 설치 협박글...
   2. [한겨레] 내란 가담자 적발, 특검 의존...
   ...
   40. [매일경제] 코스피 2500선 회복...

   요청사항:
   - 키워드 빈도 기반으로 가장 중요한 뉴스 4개 선택
   - 각 뉴스를 3문장 이내로 요약

   선택 기준:
   1. 여러 뉴스에서 반복되는 키워드 찾기
   2. 같은 키워드가 많을수록 중요한 주제
   3. 키워드 빈도 순으로 4개 선택
   4. 중복 주제 제외, 서로 다른 이슈 4개

2.2. Gemini 응답 형식

   1. [번호]
   요약: (3문장 이내 요약)

   2. [번호]
   요약: (3문장 이내 요약)

   ...

2.3. 재시도 로직 (Exponential Backoff)
   - Gemini API 500 에러 대응
   - 최대 5회 재시도
   - 대기 시간: 1초 → 2초 → 4초 → 8초 → 16초
   - 일시적 장애 극복

--------------------------------------------------------------------------------
Step 3: 응답 파싱 및 저장
--------------------------------------------------------------------------------

3.1. 파싱
   - 정규식으로 번호 추출: "1. [40]" → 40번 뉴스 선택
   - 해당 번호의 뉴스 제목, URL 매핑
   - 요약 텍스트 추출

3.2. 캐시 저장
   - 섹션별로 4개 뉴스 + 요약을 DB에 저장
   - 테이블: summary_news_cache
   - 필드: sectionId, title, url, summary, rankOrder(1~4)
   - 생성 시간: generatedAt

3.3. 캐시 갱신 주기
   - 하루 3번 자동 갱신 (스케줄러)
   - 시간: 오전 9시, 오후 2시, 오후 7시

📌 최종 출력:
   - 사용자가 선택한 카테고리별 4개 뉴스
   - 각 뉴스마다 3문장 요약 제공
   - 캐시에서 즉시 반환 (빠른 응답)


================================================================================
3. 두 알고리즘의 차이점
================================================================================

┌─────────────────┬──────────────────────┬──────────────────────┐
│     구분        │   랭킹 뉴스          │   개인화 요약 뉴스   │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 대상            │ 모든 사용자 동일     │ 사용자별 맞춤        │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 개수            │ 20개                 │ 카테고리별 4개       │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 입력 크기       │ 약 400개             │ 카테고리별 40개      │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 알고리즘        │ Java 클러스터링 +    │ Gemini AI 키워드     │
│                 │ Gemini AI 큐레이션   │ 빈도 분석            │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 클러스터링      │ O (Java)             │ X (Gemini가 처리)    │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 중복 제거       │ 제목 유사도 70%      │ X                    │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 요약            │ Gemini 요약 (본문)   │ Gemini 요약 (제목)   │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 갱신 주기       │ 수동/스케줄러        │ 하루 3번 자동        │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 선정 기준       │ 클러스터 크기        │ 키워드 빈도          │
│                 │ (사회적 영향력)      │ (중요도)             │
├─────────────────┼──────────────────────┼──────────────────────┤
│ 겹침 가능성     │ 있음 (자연스러움)    │ 있음                 │
└─────────────────┴──────────────────────┴──────────────────────┘


================================================================================
4. 기술 스택 및 구현 상세
================================================================================

4.1. 사용 기술
   - 언어: Java 17
   - 프레임워크: Spring Boot 3.4.5
   - AI: Google Gemini 2.5 Flash API
   - 크롤링: Jsoup
   - DB: MySQL + JPA/Hibernate

4.2. 주요 클래스

   랭킹 뉴스:
   - NewsRankingService: 전체 프로세스 관리
   - NewsClusteringService: Phase 1 클러스터링
   - NewsRankingSelectionService: Phase 2 Gemini 선정
   - NewsCluster: 클러스터 데이터 구조

   개인화 뉴스:
   - NewsSelectionService: Gemini 기반 선정 및 요약
   - NaverSectionCrawler: 섹션별 크롤링
   - SummaryNewsCache: 캐시 엔티티

4.3. 성능 최적화
   - 캐시 활용 (개인화 뉴스)
   - @Transactional + flush() (랭킹 뉴스)
   - Exponential Backoff 재시도 (Gemini API)
   - 중복 제거 알고리즘 (Jaccard Similarity)


================================================================================
5. 참고 사항
================================================================================

5.1. 알고리즘 영감
   - 네이버 뉴스 추천 시스템
   - SI (Social Impact) 점수 개념
   - 클러스터링 기반 다양성 확보

5.2. 향후 개선 가능 사항
   - 사용자 클릭/조회 데이터 반영
   - 실시간 트렌드 반영
   - 더 정교한 자연어 처리 (형태소 분석)
   - 사용자별 추천 모델 (협업 필터링)

================================================================================